<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Calculadora de Camadas</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 700px;
      margin: 30px auto;
      background: #f7f9fb;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 12px rgba(0,0,0,0.08);
    }
    h1 { text-align: center; color: #004d7a; margin-bottom: 8px; }
    label { display: block; margin-top: 12px; font-weight: 600; }
    input, select {
      width: 100%;
      padding: 8px;
      margin-top: 6px;
      box-sizing: border-box;
      border-radius: 6px;
      border: 1px solid #cfcfcf;
      font-size: 14px;
    }
    .row { display: flex; gap: 12px; }
    .row > div { flex: 1; }
    button {
      margin-top: 14px;
      width: 100%;
      padding: 10px;
      background: #0077b6;
      color: #fff;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
    }
    button.secondary { background: #28a745; margin-top: 8px; }
    button:disabled { opacity: 0.6; cursor: not-allowed; }
    .resultado {
      margin-top: 18px;
      background: #e9f7ff;
      padding: 12px;
      border-radius: 8px;
      border-left: 4px solid #0077b6;
    }
    .resultado p { margin: 6px 0; font-size: 15px; }
    .small { font-size: 13px; color: #666; margin-top: 6px; }
  </style>
</head>
<body>

  <h1>Calculadora de Camadas</h1>

  <div class="row">
    <div>
      <label>Data (automática):</label>
      <input type="text" id="dataAtual" readonly>
    </div>
    <div>
      <label>Estaca:</label>
      <input type="text" id="estaca" placeholder="Ex: 12+345">
    </div>
  </div>

  <label>Pano (marcação):</label>
  <input type="text" id="pano" placeholder="Ex: Pano 25">

  <label>Altura medida (m):</label>
  <input type="number" id="altura" step="0.01" placeholder="Ex: 1.00">

  <div class="row">
    <div>
      <label>Inclinação (%):</label>
      <input type="number" id="inclinacao" step="0.1" placeholder="Ex: 50">
    </div>
    <div>
      <label>Espessura da camada (m):</label>
      <input type="number" id="camada" step="0.01" placeholder="Ex: 0.25">
    </div>
  </div>

  <label>Folga da estaca (m):</label>
  <input type="number" id="folga" step="0.01" placeholder="Ex: 0.20">

  <div class="row">
    <div>
      <label>Leitura bordo esquerdo (m):</label>
      <input type="number" id="bordoEsquerdo" step="0.01" placeholder="Ex: 100.25">
    </div>
    <div>
      <label>Leitura bordo direito (m):</label>
      <input type="number" id="bordoDireito" step="0.01" placeholder="Ex: 101.30">
    </div>
  </div>

  <button id="btnCalcular">Calcular</button>
  <button id="btnSalvar" class="secondary" disabled>Salvar na planilha</button>
  <div class="small">Após calcular, clique em <strong>Salvar</strong> para gravar os dados na planilha online.</div>

  <div class="resultado" id="resultado" style="display:none"></div>

<script>
  // === DATA AUTOMÁTICA ===
  function atualizarData() {
    const agora = new Date();
    const formatar = n => String(n).padStart(2, '0');
    const dataStr = `${formatar(agora.getDate())}/${formatar(agora.getMonth()+1)}/${agora.getFullYear()} ${formatar(agora.getHours())}:${formatar(agora.getMinutes())}`;
    document.getElementById('dataAtual').value = dataStr;
  }
  atualizarData();

  let ultimoResultado = null;

  // === CÁLCULOS ===
  document.getElementById('btnCalcular').addEventListener('click', () => {
    const vals = {
      altura: parseFloat(document.getElementById('altura').value),
      inclinacao: parseFloat(document.getElementById('inclinacao').value),
      camada: parseFloat(document.getElementById('camada').value),
      folga: parseFloat(document.getElementById('folga').value),
      bordoEsquerdo: parseFloat(document.getElementById('bordoEsquerdo').value),
      bordoDireito: parseFloat(document.getElementById('bordoDireito').value)
    };

    if (Object.values(vals).some(v => isNaN(v))) {
      alert('Preencha todos os campos numéricos corretamente!');
      return;
    }

    if (vals.inclinacao === 0) {
      alert('A inclinação não pode ser zero.');
      return;
    }

    // Fórmulas
    const diferencaCota = vals.bordoDireito - vals.bordoEsquerdo;
    const novaAltura = vals.altura - vals.camada;
    const novaDist = novaAltura / (vals.inclinacao / 100);
    const distFinal = novaDist + vals.folga;
    const valorBordoEsquerdo = vals.bordoEsquerdo - novaAltura;
    const valorBordoDireito = vals.bordoDireito - novaAltura;

    // Exibir resultados
    const resultDiv = document.getElementById('resultado');
    resultDiv.style.display = 'block';
    resultDiv.innerHTML = `
      <p><strong>Diferença de cota (Δh):</strong> ${diferencaCota.toFixed(3)} m</p>
      <p><strong>Nova altura projetada:</strong> ${novaAltura.toFixed(3)} m</p>
      <p><strong>Nova distância até o bordo:</strong> ${novaDist.toFixed(3)} m</p>
      <p><strong>Distância final com folga:</strong> ${distFinal.toFixed(3)} m</p>
      <p><strong>Valor bordo esquerdo:</strong> ${valorBordoEsquerdo.toFixed(3)} m</p>
      <p><strong>Valor bordo direito:</strong> ${valorBordoDireito.toFixed(3)} m</p>
    `;

    ultimoResultado = {
      data: document.getElementById('dataAtual').value,
      estaca: document.getElementById('estaca').value || '',
      pano: document.getElementById('pano').value || '',
      ...vals,
      diferencaCota,
      novaAltura,
      novaDist,
      distFinal,
      valorBordoEsquerdo,
      valorBordoDireito
    };

    document.getElementById('btnSalvar').disabled = false;
  });

  // === SALVAR NA PLANILHA ===
  document.getElementById('btnSalvar').addEventListener('click', async () => {
    if (!ultimoResultado) return alert('Você precisa calcular antes de salvar.');

    const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbwN1FWSyw6KOjcusbC4vUxIez5xt-JtdSm5FihfpHbwfEt3ALfjw0TjMovh1w9kVyrVww/exec";

    const btnSalvar = document.getElementById('btnSalvar');
    btnSalvar.disabled = true;
    btnSalvar.innerText = 'Enviando...';

    try {
      await fetch(WEBAPP_URL, {
        method: "POST",
        mode: "no-cors",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(ultimoResultado)
      });
      alert("Dados enviados com sucesso!");
    } catch (err) {
      alert("Erro ao salvar: " + err.message);
    }

    btnSalvar.innerText = 'Salvar na planilha';
    btnSalvar.disabled = true;
  });
</script>

</body>
</html>
